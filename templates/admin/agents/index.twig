{% extends 'admin/layout.twig' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Агенты</h1>
    <a class="btn btn-primary" href="/admin/agents/create">Добавить агента</a>
</div>

<div class="table-responsive">
    <table class="table table-striped align-middle">
        <thead>
        <tr>
            <th>ID</th>
            <th>Логин</th>
            <th>Права</th>
            <th></th>
        </tr>
        </thead>
        <tbody id="agents-table">
        {% for a in agents %}
            <tr>
                <td>{{ a.id }}</td>
                <td>{{ a.login|e }}</td>
                <td><code>{{ a.permissions|e }}</code></td>
                <td class="text-end">
                    <a class="btn btn-sm btn-outline-secondary" href="/admin/agents/{{ a.id }}/edit">Редактировать</a>
                    <button class="btn btn-sm btn-outline-danger js-delete" data-id="{{ a.id }}">Удалить</button>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="4" class="text-center text-muted">Нет записей</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<form id="delete-agent-form" method="post" style="display:none"></form>

{% endblock %}

{% block scripts %}
<script>
$(function(){
  $('#agents-table').on('click', '.js-delete', function(){
    const id = $(this).data('id');
    if (!confirm('Удалить агента #' + id + '?')) return;
    const form = $('#delete-agent-form');
    form.attr('action', '/admin/agents/' + id + '/delete');
    form.submit();
  });
});
</script>
{% endblock %}

